---
description: 基于交互或提供的原则输入，创建或更新项目宪章，并确保所有依赖模板同步。
---

向你提供的用户输入可以由智能体直接传入，或作为命令参数提供——如果不为空，你在继续执行提示前**必须**予以考虑。

User input:

$ARGUMENTS

你将更新位于 `.specify/memory/constitution.md` 的项目宪章。该文件是一个模板，包含方括号占位符（例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）。你的工作是：（a）收集/推导具体值，（b）精准填充模板，（c）将任何修订同步传播到依赖工件。

遵循以下执行流：

1. 加载现有宪章模板 `.specify/memory/constitution.md`。
   - 识别所有形如 `[ALL_CAPS_IDENTIFIER]` 的占位符标记。
   **重要**：用户可能要求的原则数量少于或多于模板中的示例数量。若指定了数量，请尊重该要求——遵循通用模板并据此更新文档。

2. 为占位符收集/推导取值：
   - 若用户输入（会话）提供了值，则使用之。
   - 否则从仓库上下文推断（README、文档、历史宪章版本等）。
   - 关于治理日期：`RATIFICATION_DATE` 为最初采纳日期（未知则询问或标记 TODO），`LAST_AMENDED_DATE` 若本次有修改则为今日，否则保持原值。
   - `CONSTITUTION_VERSION` 必须遵循语义化版本规则递增：
     * MAJOR：破坏性治理/原则移除或重定义。
     * MINOR：新增原则/章节或实质性扩展指南。
     * PATCH：澄清、措辞、错别字修正，不改变语义。
   - 若版本提升类型不明确，请先给出理由再定稿。

3. 起草更新后的宪章内容：
   - 用具体文本替换每个占位符（不应剩余任何方括号标记；若项目有意保留某些模板槽位，需明确说明理由）。
   - 保留标题层级；替换后的说明性注释可移除，除非仍有价值。
   - 确保每条原则包含：精炼名称行、概述不可协商规则的段落（或要点列表）、必要时的明确动机。
   - 确保 Governance 章节包含修订流程、版本策略与合规审查预期。

4. 一致性传播检查清单（将以往清单转化为主动校验）：
   - 阅读 `.specify/templates/plan-template.md`，确保任何“宪章检查”或规则与更新后原则一致。
   - 阅读 `.specify/templates/spec-template.md`，若宪章增删了必需章节或约束，则相应更新。
   - 阅读 `.specify/templates/tasks-template.md`，确保任务分类体现新增或移除的原则驱动任务类型（如可观测性、版本化、测试规范）。
   - 阅读 `.specify/templates/commands/*.md`（包含本文件），确认不再保留过时引用（如特定代理名称）而应采用通用指引。
   - 阅读运行期指引文档（如 `README.md`、`docs/quickstart.md` 等），更新与原则相关的引用。

5. 生成同步影响报告（在宪章文件顶部以 HTML 注释形式追加）：
   - 版本变更：old → new
   - 修改的原则列表（如重命名：旧标题 → 新标题）
   - 新增章节
   - 移除章节
   - 需更新的模板（✅ 已更新 / ⚠ 待处理）及路径
   - 如有故意延期的占位符，列出后续 TODO

6. 输出前校验：
   - 不应残留未解释的方括号标记。
   - 版本行与报告一致。
   - 日期使用 ISO 格式 YYYY-MM-DD。
   - 原则具备宣告性、可测试性，避免模糊语言（将 “should” 转换为 MUST/SHOULD 并给出理由）。

7. 将完成的宪章写回 `.specify/memory/constitution.md`（覆盖写入）。

8. 向用户输出简要总结：
   - 新版本与升级理由。
   - 任何需要手动跟进的文件。
   - 建议的提交信息（例如：`docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

格式与风格要求：
- 与模板中的 Markdown 标题级别完全一致（不要升降级）。
- 为保持可读性可适度换行（理想 <100 字符），但避免生硬断行。
- 章节之间保持单一空行。
- 避免行尾空格。

若用户仅提供部分更新（如仅一条原则修订），仍需执行校验与版本决策步骤。

若关键信息缺失（如确实未知的采纳日期），插入 `TODO(<FIELD_NAME>): explanation`，并在同步影响报告中标注为延期项。

不要创建新模板；始终在现有 `.specify/memory/constitution.md` 上操作。
